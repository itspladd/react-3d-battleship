(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{113:function(e,t,n){},114:function(e,t,n){"use strict";n.r(t);var i=n(12),r=n.n(i),s=n(62),o=n.n(s),a=(n(69),n(11)),c=n(9),u=n(63),l=n.n(u),h=(n(99),n(23)),d=n.n(h),v=n(33),f=n(40),p=f.GameEngine,y=f.CONSTANTS;var g=n(19),_=n(0),b=n(1),m=n(6),O=n(10),j=n(2),k=n(3),T=n(64),w=n(34),E=n(5),I=n(4),S=n(13),P=S.TILE_GEOMETRY.TILE_RADIUS,D=(S.TILE_GEOMETRY.TILE_HEIGHT,S.TILE_GEOMETRY.TILE_THICKNESS),H=(S.TILE_GEOMETRY.TILE_BASE,function e(t){Object(_.a)(this,e),this._timestamp=Date.now()});H.boardColor=new m.d(S.COLORS.PLAYER_BOARD_TILE_BASE_COLOR),H.boardHoverColor=new m.d(S.COLORS.PLAYER_BOARD_TILE_HOVER_COLOR),H.fillerColor=new m.d(S.COLORS.TILE_NONINTERACTIVE_COLOR),H.material=new m.n(Object(a.a)({},S.MATERIALS.TILE_MATERIAL)),H.geometry=new m.e(.95*P,P,D,6).rotateX(.5*Math.PI).rotateZ(.5*Math.PI);var M=function(e){Object(j.a)(n,e);var t=Object(k.a)(n);function n(e,i,r){var s,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H.fillerColor;return Object(_.a)(this,n),(s=t.call(this))._id=e,s._mesh=i,s._color=o,s.color=o,s._x=r[0],s._y=r[1],s.position3D=r,s}return Object(b.a)(n,[{key:"id",get:function(){return this._id}},{key:"color",get:function(){return this._color},set:function(e){this._mesh.setColorAt(this._id,e)}},{key:"position3D",get:function(){var e=this._mesh.getMatrixAt(this._id),t=new m.v;return t.setFromMatrixPosition(e),t},set:function(e){var t=Object(c.a)(e,3),n=t[0],i=t[1],r=t[2];this._mesh.setMatrixAt(this._id,ie.getXYZMatrix(n,i,r))}},{key:"position",get:function(){return[this._x,this._y]}}]),n}(H),L=function(e){Object(j.a)(n,e);var t=Object(k.a)(n);function n(e,i,r,s,o){var a;return Object(_.a)(this,n),(a=t.call(this,e,i,r,s))._hoverColor=o,a}return Object(b.a)(n,[{key:"currentlyHovered",value:function(e){return e.intersectObject(this._mesh)[0].instanceId===this.id}},{key:"onHover",value:function(){this.color=this._hoverColor,this._mesh.instanceColor.needsUpdate=!0}},{key:"duringHover",value:function(){}},{key:"onHoverExit",value:function(){this.color=this._color,this._mesh.instanceColor.needsUpdate=!0}},{key:"hoverData",get:function(){return{id:this.id,position:this.position,color:this.color.getHexString(),hoverColor:this._hoverColor.getHexString()}}},{key:"hoverable",get:function(){return!0}}]),n}(M),A={Tile:H,InstancedTile:M,HoverableTile:L,PlayerBoardTile:function(e){Object(j.a)(n,e);var t=Object(k.a)(n);function n(e,i,r,s,o){var a;return Object(_.a)(this,n),(a=t.call(this,e,i,r,H.boardColor,H.boardHoverColor))._owner=s,a._engine=a.owner.engine.tiles[a.boardX][a.boardY],a._type=o,a}return Object(b.a)(n,[{key:"owner",get:function(){return this._owner}},{key:"engine",get:function(){return this._engine}},{key:"playerId",get:function(){return this._owner.playerId}},{key:"hoverData",get:function(){var e=Object(E.a)(Object(I.a)(n.prototype),"hoverData",this);return Object(a.a)(Object(a.a)({},e),{},{player:this.playerId})}},{key:"type",set:function(e){this._type=e}},{key:"boardX",get:function(){return this._x-this.owner.startX}},{key:"boardY",get:function(){return this._y-this.owner.startY}},{key:"boardPosition",get:function(){return[this.boardX,this.boardY]}}]),n}(L)},R=n(13).TILE_GEOMETRY,x=R.TILE_RADIUS,C=R.TILE_HEIGHT,B=function(){function e(t){Object(_.a)(this,e),this._mesh=t||null}return Object(b.a)(e,[{key:"mesh",get:function(){return this._mesh},set:function(e){this._mesh=e}},{key:"meshPosition",get:function(){return this._mesh.position}},{key:"meshX",get:function(){return this._mesh.position.x}},{key:"meshY",get:function(){return this._mesh.position.y}},{key:"meshZ",get:function(){return this._mesh.position.z}},{key:"angle",get:function(){var e=new m.p(0,0,0,1),t=Math.round(360*this._mesh.quaternion.angleTo(e)/(2*Math.PI));return 360===t||0===t?0:this.mesh.quaternion._w>0?-1*(t-360):t},set:function(e){var t=(e=-1*(e-360))/360*2*Math.PI,n=new m.v(0,0,1);this.mesh.setRotationFromAxisAngle(n,t)}},{key:"boardX",get:function(){return Math.round(this.meshX/e.xPerTile)},set:function(e){this.boardPosition=[e,this.boardY,this.boardZ]}},{key:"boardY",get:function(){var t=this.boardX%2*e.oddColumnOffset;return-1*Math.round((this.meshY+t)/e.yPerTile)},set:function(e){this.boardPosition=[this.boardX,e,this.boardZ]}},{key:"boardZ",get:function(){return this.meshZ},set:function(e){this.boardPosition=[this.boardX,this.boardY,e]}},{key:"boardPosition",get:function(){return[this.boardX,this.boardY]},set:function(t){var n=Object(c.a)(t,3),i=n[0],r=n[1],s=n[2],o=i*e.xPerTile,a=-1*(r*e.yPerTile+i%2*e.oddColumnOffset),u=s||0===s?s:e.defaultZ;this.mesh.position.x=o,this.mesh.position.y=a,this.mesh.position.z=u}}]),e}();B.xPerTile=1.5*x,B.yPerTile=2*C,B.oddColumnOffset=B.yPerTile/2,B.defaultZ=0,B.hoverZ=2.5;var N=B,Y=A.Tile,X=A.PlayerBoardTile,G=n(13).BOARD_DIMENSIONS.SHIP_NULL_START,U=function(){function e(t,n,i){Object(_.a)(this,e),this._owner=t,this._engine=t.engine.board;var r=i.startX,s=i.startY,o=i.endX,a=i.endY;this._start=[r,s],this._end=[o,a],this._rows=n.rows,this._columns=n.columns,this.tileMesh=new m.i(Y.geometry,Y.material,this.numTiles),this.tileMesh.frustumCulled=!1;var u=this.makeTiles(n),l=Object(c.a)(u,2),h=l[0],d=l[1];this.tilesById=h,this.tilesByPosition=d,this.ships=this.makeShips(n),this.placedShips={},this.updateShip=this.updateShip.bind(this)}return Object(b.a)(e,[{key:"engine",get:function(){return this._engine}},{key:"tiles",get:function(){return this.tilesById}},{key:"shipsArr",get:function(){return Object.values(this.ships)}},{key:"startX",get:function(){return this._start[0]}},{key:"startY",get:function(){return this._start[1]}},{key:"endX",get:function(){return this._end[0]}},{key:"endY",get:function(){return this._end[1]}},{key:"dimensions",get:function(){return[this._rows,this._columns]}},{key:"numTiles",get:function(){return this._rows*this._columns}},{key:"playerId",get:function(){return this._owner.id}},{key:"shipMeshes",get:function(){return Object.values(this.ships).map((function(e){return e.mesh}))}},{key:"makeTiles",value:function(e){var t,n=0,i=this.startY,r={},s=[],o=Object(g.a)(e.tiles);try{for(o.s();!(t=o.n()).done;){var a,c=t.value,u=[],l=this.startX,h=Object(g.a)(c);try{for(h.s();!(a=h.n()).done;){var d=a.value,v=[l,i,0],f=d.typeStack[d.typeStack.length-1];r[n]=new X(n,this.tileMesh,v,this,f),u.push(n),n++,l++}}catch(p){h.e(p)}finally{h.f()}i++,s.push(u)}}catch(p){o.e(p)}finally{o.f()}return[r,s]}},{key:"makeShips",value:function(e){var t=e.ships,n={},i=0,r=G.x,s=G.y,o=G.angle;for(var c in t){var u=[2*i+r,s,o],l=Object(a.a)(Object(a.a)({},t[c]),{},{nullPosition:u,owner:this});n[c]=new ce(l),i++}return n}},{key:"updateShip",value:function(e){var t=e.id,n=e.position,i=e.angle;if(null===n)this.ships[t].placeAtNull();else{var r=Object(c.a)(n,2),s=r[0],o=r[1],a=s+this.startX,u=o+this.startY,l=this.placedShips[t]?ce.zOffset:N.hoverZ;this.ships[t].boardPosition=[a,u,l],this.ships[t].angle=i}}},{key:"currentHover",value:function(e){var t=e.intersectObject(this.tileMesh)[0];return t&&this.tiles[t.instanceId]}},{key:"onHover",value:function(){}},{key:"onHoverExit",value:function(){}}]),e}(),Z=function(){function e(t,n,i){Object(_.a)(this,e);var r=n.id,s=n.name,o=n.rules,a=n.board;this._owner=t,this._id=r,this._engine=this._owner.engine.players[r],this._name=s,this._rules=o,this.board=new U(this,a,i)}return Object(b.a)(e,[{key:"engine",get:function(){return this._engine}},{key:"id",get:function(){return this._id}}]),e}(),F=A.Tile,V=A.InstancedTile,W=(n(40).HELPERS.positionHelpers.getNeighborsInDirection,n(13).TILE_GEOMETRY),z=W.TILE_RADIUS,q=W.TILE_HEIGHT,J=n(13).BOARD_DIMENSIONS,K=J.ROWS_TOP,Q=J.ROWS_BOTTOM,$=J.COLUMNS_LEFT,ee=J.COLUMNS_RIGHT,te=J.COLUMNS_BETWEEN,ne=function(){function e(t,n,i){Object(_.a)(this,e),this.findPlayerBoundaries=function(e,t){for(var n=Object.values(e.players);n[0].id!==t;)n.push(n.shift());for(var i=[],r=$-1,s=0;s<n.length;s++){var o=n[s],a=o.id,c=1+r+te*s,u=K,l=c+o.board.columns-1,h=u+o.board.rows-1;r=l,i[s]={id:a,startX:c,startY:u,endX:l,endY:h}}return i},this._ownerID=n,this._gameStateRef=t,this._engine=i,this.mapDimensions=this.mapDimensions(this.currentState),this.boardBoundaries=this.findPlayerBoundaries(this.currentState,n),this.players=this.initPlayers(this.currentState,this.boardBoundaries),this.fillerTiles=this.initFillerTiles()}return Object(b.a)(e,[{key:"engine",get:function(){return this._engine}},{key:"mapRows",get:function(){return this.mapDimensions[0]}},{key:"mapColumns",get:function(){return this.mapDimensions[1]}},{key:"totalTiles",get:function(){return this.mapRows*this.mapColumns}},{key:"playerShipMeshes",get:function(){return this.players[this._ownerID].board.shipMeshes}},{key:"currentState",get:function(){return this._gameStateRef.current}},{key:"owningPlayer",get:function(){return this.players[this._ownerID]}},{key:"ownerID",get:function(){return this._ownerID}},{key:"playersArr",get:function(){return Object.values(this.players)}},{key:"hoverables",get:function(){var e=this.owningPlayer.board.shipsArr,t=this.playersArr.map((function(e){return e.board}));return[].concat(Object(w.a)(e),Object(w.a)(t))}},{key:"selectables",get:function(){var e=this.owningPlayer.board.shipsArr;return Object(w.a)(e)}},{key:"initPlayers",value:function(e,t){var n=this,i={},r=function(r){var s=t.filter((function(e){return e.id===r}))[0];i[r]=new Z(n,e.players[r],s)};for(var s in e.players)r(s);return i}},{key:"initFillerTiles",value:function(){var e=new m.i(F.geometry,F.material,this.totalTiles);e.frustumCulled=!1;for(var t={},n=0,i=0;i<this.mapColumns;i++)for(var r=0;r<this.mapRows;r++)if(!this.locationInBoardBoundaries(i,r)){var s=[i,r,0];t[n]=new V(n,e,s),n++}return e}},{key:"locationInBoardBoundaries",value:function(e,t){var n=this;return 0!==Object.values(this.boardBoundaries).filter((function(i){var r=i.startX,s=i.startY,o=i.endX,a=i.endY;return n.locationInArea(e,t,[r,s],[o,a])})).length}},{key:"locationInArea",value:function(e,t,n,i){return e>=n[0]&&e<=i[0]&&t>=n[1]&&t<=i[1]}},{key:"mapDimensions",value:function(e){var t=Object.values(e.players),n=t[0].board.rows,i=t.map((function(e){return e.board.columns})).reduce((function(e,t){return e+t})),r=t.length-1;return[n+K+Q,i+te*r+$+ee]}},{key:"update",value:function(){var e=this;Object.values(this.currentState.players).forEach((function(t){var n=t.id,i=t.board,r=Object.values(i.ships),s=e.players[n].board;s.placedShips=Object(a.a)({},i.placedShips);s.ships;r.forEach(s.updateShip)}))}}],[{key:"moveObject",value:function(e,t,n){var i=Object(c.a)(t,3),r=i[0],s=i[1],o=i[2];this.moveObjectBy(e,r,s,o),this.rotateObjDeg(e,n)}},{key:"rotateObjDeg",value:function(e,t){var n=(t=-1*(t-360))/360*2*Math.PI;e.rotateZ(n)}},{key:"moveObjectBy",value:function(e,t,n,i){var r=this.getXYZMatrix(t,n,i);e.applyMatrix(r)}},{key:"getXYZMatrix",value:function(e,t,n){var i=this.getXYCoordinates(e,t),r=Object(c.a)(i,2),s=r[0],o=r[1],a=new m.k;return a.makeTranslation(s,o,n),a}},{key:"getXYCoordinates",value:function(e,t){var n=2*q;return[e*(1.5*z),-1*(t*n+e%2*(n/2))]}}]),e}();ne.baseRotationMatrix=(new m.k).makeRotationX(Math.PI);var ie=ne,re=A.PlayerBoardTile,se=S.TILE_GEOMETRY.TILE_HEIGHT,oe=S.TILE_GEOMETRY.TILE_BASE,ae=function(e){Object(j.a)(n,e);var t=Object(k.a)(n);function n(e){var i,r=e.typeStr,s=e.segments,o=e.angle,a=(e.position,e.nullPosition),u=e.id,l=e.owner;Object(_.a)(this,n);var h=n.makeSegments(r,s),d=Object(c.a)(h,2),v=d[0],f=d[1];return(i=t.call(this,f))._owner=l,i._engine=l.engine.ships[u],i._type=r,i._segmentArr=v,i._segmentGroup=f,i._angle=o,i._id=u,i._nullPosition=a,i._selected=!1,i._hovered=!1,i._placed=!1,i.placeAtNull(),i}return Object(b.a)(n,[{key:"owner",get:function(){return this._owner}},{key:"engine",get:function(){return this._engine}},{key:"id",get:function(){return this._id}},{key:"segmentMeshes",get:function(){return this._segmentGroup.children}},{key:"nullX",get:function(){return this._nullPosition[0]}},{key:"nullY",get:function(){return this._nullPosition[1]}},{key:"nullAngle",get:function(){return this._nullPosition[2]}},{key:"atNull",get:function(){return this.boardX===this.nullX&&this.boardY===this.nullY}},{key:"enginePosition",get:function(){return this.atNull?null:[this.boardX-this.owner.startX,this.boardY-this.owner.startY]}},{key:"hovered",get:function(){return this._hovered}},{key:"selected",get:function(){return this._selected}},{key:"placed",get:function(){return this._placed},set:function(e){this._placed=e}},{key:"hoverData",get:function(){return{id:this._id,position:this.boardPosition,angle:this._angle,nullPosition:this._nullPosition,type:this._type,placed:this.placed}}},{key:"color",set:function(e){this._segmentArr.forEach((function(t){t.mesh.material.color=e}))}},{key:"placeAtNull",value:function(){var e=Object(c.a)(this._nullPosition,3),t=e[0],n=e[1],i=e[2];this.angle=i,this.boardPosition=[t,n]}},{key:"currentHover",value:function(e){return e.intersectObjects(this.segmentMeshes).length>0&&this}},{key:"onHover",value:function(){this._hovered=!0,this.color=n.hoverColor}},{key:"onHoverExit",value:function(){this._hovered=!1,this.color=n.color}},{key:"onSelect",value:function(){this._selected=!0,this._placed=!1,this.color=n.hoverColor,this.boardZ=N.hoverZ}},{key:"onDeselect",value:function(){this._selected=!1,this.color=n.color}},{key:"onPlace",value:function(){this._placed=!0}},{key:"canMoveTo",value:function(e){return e instanceof re&&e.owner.playerId===this.owner.playerId}}],[{key:"makeSegments",value:function(e,t){var i=t.map((function(t,i){var r=n.makeSegmentMesh(e,i);return r.position.y=i*(2*se),Object(a.a)(Object(a.a)({},t),{},{mesh:r})})),r=new m.h;return i.forEach((function(e){return r.add(e.mesh)})),[i,r]}},{key:"makeSegmentMesh",value:function(e,t){var i=2*se,r=new m.c(1,i,1),s=new m.m({color:n.color});return new m.l(r,s)}}]),n}(N);ae.color=new m.d(6710886),ae.hoverColor=new m.d(8947848),ae.zOffset=.5+oe,ae.nullZOffset=0;var ce=ae,ue=A.PlayerBoardTile,le=n(40).CONSTANTS.RULES.DEFAULT_RULES.MOVES,he=function(e){Object(j.a)(n,e);var t=Object(k.a)(n);function n(e,i,r,s){var o;return Object(_.a)(this,n),(o=t.call(this,e,i))._raycaster=new m.q,o.setViewerData=r,o.setMoveData=s,o._currentHovers=[],o._prevHovers=[],o._currentSelected=[],o._prevSelected=[],o._placementTargets=[],o.mainHover=null,o.enableHovering=!0,o.enableSelection=!0,o._pointer=o.setupPointer(),o.maxPolarAngle=3/16*Math.PI,o.minPolarAngle=0,o.onPointerMove=o.onPointerMove.bind(Object(O.a)(o)),o.onPointerDown=o.onPointerDown.bind(Object(O.a)(o)),o.onPointerUp=o.onPointerUp.bind(Object(O.a)(o)),o.onWheel=o.onWheel.bind(Object(O.a)(o)),o.handleNewHover=o.handleNewHover.bind(Object(O.a)(o)),o.handleAbandonedHover=o.handleAbandonedHover.bind(Object(O.a)(o)),i.addEventListener("mousemove",o.onPointerMove,!1),i.addEventListener("pointerdown",o.onPointerDown,!1),i.addEventListener("pointerup",o.onPointerUp,!1),i.addEventListener("wheel",o.onWheel,!1),o}return Object(b.a)(n,[{key:"camera",get:function(){return this.object}},{key:"game",get:function(){return this._game},set:function(e){this._game=e}},{key:"engine",get:function(){return this._engine},set:function(e){this._engine=e}},{key:"gamePlayer",get:function(){return this.game.players[this.playerID]}},{key:"gameBoard",get:function(){return this.gamePlayer.board}},{key:"enginePlayer",get:function(){return this.engine.players[this.playerID]}},{key:"engineBoard",get:function(){return this.enginePlayer.board}},{key:"engineShip",get:function(){return this.selection?this.engineBoard.ships[this.selection.id]:null}},{key:"playerID",get:function(){return this._game.ownerID}},{key:"pointerDelta",get:function(){return Date.now()-this._pointerDownTime}},{key:"dragging",get:function(){return this.pointerDown&&this.pointerDelta>500}},{key:"selection",get:function(){return this._currentSelected[0]||null},set:function(e){this._currentSelected.push(e)}},{key:"placementTarget",get:function(){return this._placementTargets[0]||null}},{key:"myBoardHovers",get:function(){var e=this;return this._currentHovers.filter((function(e){return e instanceof ue})).filter((function(t){return t.playerId===e.playerID}))}},{key:"newMainHover",get:function(){return this.mainHover&&this.prevMainHover&&this.mainHover!==this.prevMainHover}},{key:"debugData",get:function(){return{hovers:this._currentHovers,selection:this.selection,placementTarget:this.placementTarget&&this.placementTarget.constructor}}},{key:"initGame",value:function(e,t,n){this.game=e,this.engine=n}},{key:"deselect",value:function(){this.selection.onDeselect(),this._currentSelected.pop(),this.enableZoom=!0}},{key:"select",value:function(){this.selection=this._potentialSelect,this.selection.placed&&(this.selection.placed=!1,this.sendUnplaceShipMove(this.selection.id)),this.selection.onSelect(),this.enableZoom=!1,this._potentialSelect=null}},{key:"handleAnimationLoop",value:function(){this._raycaster.setFromCamera(this._pointer,this.camera),this.detectHovers()&&this.handleHovers()&&this.updateData()}},{key:"updateData",value:function(){}},{key:"setupPointer",value:function(){return new m.u(-1,-1)}},{key:"onPointerMove",value:function(e){this._pointer.x=e.clientX/window.innerWidth*2-1,this._pointer.y=-e.clientY/window.innerHeight*2+1;var t={normalizedPosition:[this._pointer.x,this._pointer.y],rawPosition:[e.clientX,e.clientY]},n={position:this.camera.position,rotation:this.camera.quaternion};this.setViewerData((function(e){return Object(a.a)(Object(a.a)({},e),{},{pointer:t,camera:n})}))}},{key:"onPointerDown",value:function(e){var t=this;e.preventDefault(),this._pointerDownTime=Date.now(),this.pointerDown=!0,this.game&&(this._potentialSelect=this._currentHovers.filter((function(e){return t.game.selectables.includes(e)})).pop(),this._potentialSelect&&(this.enablePan=!1,setTimeout((function(){return t.enablePan=!0}),100)))}},{key:"onPointerUp",value:function(e){e.preventDefault(),this.dragging||(this.selection?this.canPlace(this.selection)?(console.log("placing current selection"),this.place(this.selection,this.placementTarget),this.deselect()):this._potentialSelect?(console.log("selecting new item"),this.deselect(),this.select()):!this.myBoardHovers.length>0&&(console.log("putting down current item"),this.sendMoveShipMove(this.selection.id,null,0),this.deselect()):this._potentialSelect&&this.select()),this.pointerDown=!1}},{key:"onWheel",value:function(e){if(e.preventDefault(),this.selection){var t=this.selection,n=e.deltaY>0?60:-60,i=t.atNull?[t.nullX,t.nullY]:t.enginePosition,r=t.angle+n;360===r?r=0:-60===r&&(r=300),this.sendMoveShipMove(t.id,i,r)}}},{key:"canPlace",value:function(e){var t=this.engineBoard.ships[e.id];return this._placementTargets=this._currentHovers.filter((function(t){return e.canMoveTo(t)})),this._placementTargets.length>0&&null!==t.position&&this.engineBoard.validShipLocation(t)}},{key:"detectHovers",value:function(){var e=this;this._currentHovers=[],this.game&&!this.dragging&&(this._currentHovers=this.game.hoverables.map((function(t){return t.currentHover(e._raycaster)})).filter((function(e){return!!e})),this.prevMainHover=this.mainHover,this.mainHover=this.myBoardHovers[0]),this.selection&&this.canPlace(this.selection)&&this.engineShip.segments.forEach((function(t,n){if(0!==n){var i=Object(c.a)(t.position,2),r=i[0],s=i[1],o=e.gameBoard.tiles[e.gameBoard.tilesByPosition[s][r]];e._currentHovers.push(o)}}));var t=this._currentHovers.length>0,n=this._prevHovers.length>0;return!t&&n&&this.setViewerData((function(e){return Object(a.a)(Object(a.a)({},e),{},{currentHover:null})})),t||n}},{key:"handleHovers",value:function(){var e=this,t=this._currentHovers.filter((function(t){return!e._prevHovers.includes(t)})),n=this._prevHovers.filter((function(t){return!e._currentHovers.includes(t)}));this.newMainHover&&!t.includes(this.mainHover)&&t.unshift(this.mainHover),t.forEach(this.handleNewHover),n.forEach(this.handleAbandonedHover);var i=this._currentHovers.map((function(e){return e.hoverData}))[0];return t.length>0&&this.setViewerData((function(e){return Object(a.a)(Object(a.a)({},e),{},{currentHover:i,newHovers:t})})),this._prevHovers=this._currentHovers,!0}},{key:"handleNewHover",value:function(e){!e.selected&&e.onHover();var t=this.selection;if(e===this.mainHover&&t&&t.canMoveTo(e)){t.owner.playerId;var n=t.id,i=e.boardPosition,r=t.angle;this.sendMoveShipMove(n,i,r)}}},{key:"handleAbandonedHover",value:function(e){!e.selected&&e.onHoverExit()}},{key:"place",value:function(e){e.onPlace(),this.sendPlaceShipMove(e.id)}},{key:"unplace",value:function(e){}},{key:"sendMoveShipMove",value:function(e,t,n){this.setMoveData({moveType:le.MOVE_SHIP.NAME,targetPlayerID:this.playerID,playerID:this.playerID,shipID:e,position:t,angle:n})}},{key:"sendPlaceShipMove",value:function(e){this.setMoveData({moveType:le.PLACE_SHIP.NAME,targetPlayerID:this.playerID,playerID:this.playerID,shipID:e})}},{key:"sendUnplaceShipMove",value:function(e){this.setMoveData({moveType:le.UNPLACE_SHIP.NAME,targetPlayerID:this.playerID,playerID:this.playerID,shipID:e})}}]),n}(T.a),de=function(){function e(t,n,i,r,s,o){Object(_.a)(this,e),this._canvasRef=n,this._setViewerData=i,this._messageDataRef=r,this._scene=new m.r,this._renderer=new m.w({canvas:this._canvasRef.current}),this._camera=this.setupCamera(),this._controls=this.setupControls(s,o),this._renderer.setSize(t.innerWidth,t.innerHeight),this._lights=this.setupLights(),this._axes=this.makeAxes(),this.addArr(this._lights),this.add(this._axes),this.animate=this.animate.bind(this)}return Object(b.a)(e,[{key:"controls",get:function(){return this._controls}},{key:"update",get:function(){return this._messageDataRef.current.update},set:function(e){this._messageDataRef.current.update=!1}},{key:"game",get:function(){return this._currentGame}},{key:"add",value:function(e){this._scene.add(e)}},{key:"addArr",value:function(e){var t,n=Object(g.a)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.add(i)}}catch(r){n.e(r)}finally{n.f()}}},{key:"setupCamera",value:function(){var e=new m.o(75,window.innerWidth/window.innerHeight,.1,1e3);return e.up=new m.v(0,0,1),e.position.z=20,e.position.y=0,e.position.x=0,e.lookAt(0,0,0),e}},{key:"setupControls",value:function(e){return new he(this._camera,this._canvasRef.current,this._setViewerData,e)}},{key:"initGame",value:function(e,t,n){var i=new ie(e,t,n);this._currentGame=i,this.controls.initGame(i,t,n),this.addGameToScene(i,t)}},{key:"addGameToScene",value:function(e,t){var n=this;this.add(e.fillerTiles),Object.values(e.players).forEach((function(e){n.add(e.board.tileMesh),e.id===t&&n.addArr(e.board.shipMeshes)}))}},{key:"setupLights",value:function(){var e=new m.f(16777215,1),t=new m.a(16777215,.5);return e.position.x=5,e.position.y=5,e.position.z=10,this.add(e),this.add(t),[e,t]}},{key:"makeAxes",value:function(){return new m.b(5)}},{key:"animate",value:function(){var e=Date.now();requestAnimationFrame(this.animate),this.controls.handleAnimationLoop(),this.update&&(this._currentGame.update(),this.update=!1),this._renderer.render(this._scene,this._camera);(1e3/(Date.now()-e)).toFixed(0)}},{key:"makeTestCube",value:function(){var e=new m.c(1,1,1),t=new m.m({color:65280}),n=new m.l(e,t);return n.position.x=5,n.position.y=5,n.position.z=5,n}}]),e}();var ve=n(7);function fe(){var e=Object(i.useRef)(null),t=function(){var e=new p({players:[{id:"p1",name:"Trapezius"},{id:"p2",name:"Tautrion"}]});e.timestamp=Date.now();var t=Object(i.useState)(e),n=Object(c.a)(t,2),r=n[0],s=(n[1],Object(i.useState)({})),o=Object(c.a)(s,2),a=o[0],u=o[1],l=Object(i.useRef)(r.gameState);Object(i.useEffect)((function(){u(y.RULES.DEFAULT_RULES.MOVES)}),[]);var h=function(){var e=Object(v.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("making a move: ",t),e.next=3,r.inputMove(t);case 3:return n=e.sent,l.current=n.gameState,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return[r,a,l,h]}(),n=Object(c.a)(t,4),r=n[0],s=n[1],o=n[2],a=n[3],u=function(e,t,n,r){var s=Object(i.useState)({pointer:{normalizedPosition:[-1,-1],rawPosition:[0,0]},camera:{position:[0,0,0],rotation:[0,0,0,0]},currentHover:{instanceId:"none",playerId:null,worldPosition:null,boardPosition:null,hoverable:null},currentSelect:{objectId:"none",playerId:null,ownerID:null},selectStack:[]}),o=Object(c.a)(s,2),a=o[0],u=o[1],l=Object(i.useState)(null),h=Object(c.a)(l,2),d=h[0],v=h[1],f=Object(i.useRef)({update:!1,timestamp:Date.now()});return Object(i.useEffect)((function(){var i=new de(window,e,u,f,v,n);i.initGame(t,r,n),i.animate()}),[]),[a,f,d]}(e,o,r,"p2"),l=Object(c.a)(u,3),h=l[0],f=l[1],g=l[2],_=Object(i.useState)("Waiting"),b=Object(c.a)(_,2),m=b[0],O=b[1],j=Object(i.useState)(),k=Object(c.a)(j,2),T=k[0],w=k[1],E=function(e){O("Move sent. Waiting for engine..."),a(e).then((function(e){console.log(e),O({msg:"Move handled. Results: ".concat(e.valid&&"Valid",". Updating board..."),results:e})})).then((function(){return f.current.update=!0})).catch((function(e){return console.log("yo")}))};Object(i.useEffect)((function(){g&&E(g)&&console.log("sending a move")}),[g]);var I=[];o.current.players&&Object.values(o.current.players).forEach((function(e){var t=[];Object.values(e.board.ships).forEach((function(e){t.push(Object(ve.jsxs)("li",{children:[e.id,": ",e.segments[1].position]},e.id))})),I.push(Object(ve.jsxs)("ul",{children:[Object(ve.jsxs)("li",{children:[e.id,": ",e.name]}),Object(ve.jsx)("ul",{children:t})]},e.id))})),Object(i.useEffect)((function(){w(function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[];for(var r in t)t[r]instanceof Object||Array.isArray(t[r])?i.push(Object(ve.jsxs)("details",{children:[Object(ve.jsx)("summary",{children:r}),n?e(t[r],n):"".concat(t[r])]})):i.unshift(Object(ve.jsxs)("li",{children:[r,": ",t[r]]}));return Object(ve.jsx)("ul",{children:i})}(o.current,!0))}),[o.current]);var S=function(e){return Array.isArray(e)||(e=Object.values(e)),e.map((function(e){return Number.parseFloat(e).toFixed(2)})).join(", ")},P=h.pointer.normalizedPosition,D=h.camera.position,H=h.camera.rotation,M=S(P),L=S(D),A=S(H),R=[];for(var x in h.currentHover)R.push(Object(ve.jsxs)("li",{children:[x,": ",JSON.stringify(h.currentHover[x])]},x));return Object(ve.jsxs)("div",{className:"game-window",children:[Object(ve.jsxs)("div",{id:"status",children:["Status: ",m.msg]}),Object(ve.jsxs)("div",{id:"info",children:[Object(ve.jsx)("h2",{children:"Debug panel"}),Object(ve.jsxs)("p",{children:["Board update: "," ".concat(f.current.update,", ").concat(f.current.timestamp)]}),Object(ve.jsxs)("ul",{children:[Object(ve.jsxs)("li",{children:["Mouse: ",M]}),Object(ve.jsxs)("li",{children:["Camera pos: ",L]}),Object(ve.jsxs)("li",{children:["Camera rot: ",A]})]}),Object(ve.jsxs)("details",{children:[Object(ve.jsx)("summary",{children:"Current hover info"}),Object(ve.jsx)("ul",{children:R})]}),Object(ve.jsx)("button",{onClick:function(){return function(){console.log("handling click");var e={moveType:s.MOVE_SHIP.NAME,playerID:"p2",targetPlayerID:"p2",shipID:"ship0",position:[0,0],angle:180};E(e)}()},disabled:!0,children:"Start the game"}),Object(ve.jsxs)("details",{children:[Object(ve.jsx)("summary",{children:"Game engine state"}),T]}),Object(ve.jsx)("details",{children:Object(ve.jsx)("summary",{children:"Last move results:"})}),Object(ve.jsx)("details",{children:Object(ve.jsx)("summary",{children:"Controls info"})})]}),Object(ve.jsx)("canvas",{ref:e})]})}var pe="http://127.0.0.1:8080";n(113);var ye=function(){var e=Object(i.useState)({socketConnected:!1}),t=Object(c.a)(e,2),n=t[0],r=t[1];return Object(i.useEffect)((function(){var e=l()(pe);return e.on("connection",(function(){r((function(t){return Object(a.a)(Object(a.a)({},t),{},{socketConnected:!0,socket:e})}))})),function(){e.disconnect()}}),[]),Object(ve.jsxs)("div",{className:"App",children:[Object(ve.jsx)("header",{children:Object(ve.jsxs)("p",{children:["Socket server: ",pe," |\xa0",!n.socketConnected&&"Connecting to server...",n.socketConnected&&"Connection established!"]})}),Object(ve.jsx)(fe,{})]})},ge=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,115)).then((function(t){var n=t.getCLS,i=t.getFID,r=t.getFCP,s=t.getLCP,o=t.getTTFB;n(e),i(e),r(e),s(e),o(e)}))};o.a.render(Object(ve.jsx)(r.a.StrictMode,{children:Object(ve.jsx)(ye,{})}),document.getElementById("root")),ge()},13:function(e,t){var n={ROWS_TOP:4,ROWS_BOTTOM:4,COLUMNS_LEFT:4,COLUMNS_RIGHT:4,COLUMNS_BETWEEN:2,SHIP_NULL_START:{x:0,y:-1,angle:60}},i={TILE_RADIUS:1,TILE_HEIGHT:1*Math.sin(Math.PI/3),TILE_THICKNESS:.25,TILE_SIDE:1,TILE_BASE:.125},r={TILE_MATERIAL:{color:16777215,roughness:.6,metalness:.5}},s={PLAYER_BOARD_TILE_BASE_COLOR:26367,PLAYER_BOARD_TILE_HOVER_COLOR:4487167,BAD_HOVER_COLOR:16711680,TILE_NONINTERACTIVE_COLOR:17629,LIGHT_BASE_COLOR:16777215};e.exports={BOARD_DIMENSIONS:n,TILE_GEOMETRY:i,MATERIALS:r,COLORS:s}},69:function(e,t,n){},99:function(e,t,n){}},[[114,1,2]]]);
//# sourceMappingURL=main.71771889.chunk.js.map